steps:
  - task: UseDotNet@2
    displayName: 'Use .NET Core sdk 2.x'
    inputs:
      version: 2.x
      installationPath: $(Agent.ToolsDirectory)/dotnet

  - task: UseDotNet@2
    displayName: 'Use .Net Core SDK 6.x'
    inputs:
      version: 6.x

  - task: DotNetCoreCLI@2
    displayName: 'dotnet --list-sdks '
    inputs:
      command: custom
      custom: '--list-sdks '

  - task: PowerShell@2
    displayName: "Install Strawberry Perl"
    inputs:
      targetType: filePath
      filePath: $(Build.SourcesDirectory)\$(WilsonSourceDirectory)build\install-strawberry-perl.ps1
      arguments: >
        -ci_path "$(Build.SourcesDirectory)"
        -debug
    condition: and(succeeded(), eq(variables['PipelineType'], 'onebranch'))

  - powershell: |
        perl "$(Build.SourcesDirectory)\$(WilsonSourceDirectory)src\VerifyResourceUsage.pl"
    displayName: 'Verify error messages are all used.'

  - powershell: |
      regedit /s .\build\strongNameBypass.reg
    displayName: 'Strong Name Bypass'

  - task: PowerShell@2
    displayName: 'Update Assembly Info'
    inputs:
      targetType: filePath
      filePath: ./$(WilsonSourceDirectory)updateAssemblyInfo.ps1
      arguments: '-packageType $(BuildConfiguration)'

  - task: MSBuild@1
    displayName: Build
    inputs:
      solution: $(WilsonSourceDirectory)wilson.sln
      msbuildVersion: '17.0.0'
      msbuildArchitecture: x64
      msbuildArguments: '/r:True /p:Configuration=$(BuildConfiguration) /p:Platform="Any CPU" /verbosity:m /p:SourceLinkCreate=true'